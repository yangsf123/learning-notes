# 第二章 Google生产环境：SRE视角

Google数据中心与其他传统数据中心和小型服务器集群相比非常不同，这些差异有好处也有坏处
本章详细讨论Google数据中心建设中遇到的机遇与挑战
同时，本章还介绍了一些后续章节将会反复提到的名词及含义

## 硬件
    Google的大部分计算资源都存放在自主设计的数据中心中。拥有自己设计的供电系统、制冷系统、网络系统以及计算机硬件
    和一般的服务器托管中心相比，每个数据中心的计算机硬件基本上是一致的。两种服务器说法：
    - 物理服务器(Machine)
        代表具体的硬件(有时候也代表一个VM虚拟机)
        物理服务器上可以运行任何类型的软件服务器。Google采用一套集群管理系统--Borg进行资源分配
    - 软件服务区(Server)
        代表一个对外提供服务的软件系统

    一个典型的Google数据中心的拓扑结构
        - 机柜(Rack): 约10台物理服务器组成
        - 机柜排(Row): 数台机柜组成
        - 集群(Cluster): 一排或多排机柜组成
        - 数据中心(Datacenter): 通常包含多个集群
        - 园区(Campus): 多个相邻的数据中心组成

    > 通信 每个数据中心内的物理服务器都需要能够互相进行网络通信。
    Jupiter: 用几百台Google自制交换机以Clos连接方式连接起来创建了一个非常快的虚拟网络交换机，这个交换机有几万个虚拟端口
    在Google最大的数据中心内，Jupiter可以提供1.3Pb/s的交叉带宽

    Google的数据中心是由一套全球覆盖的骨干网B4连接起来的
    B是基于SDN网络技术(使用OpenFlow标准协议)构建的，可以给中型规模的骨干网络提供海量带宽，同时可以利用动态带宽管理优化网络连接，最大化平均带宽
## 管理物理服务器的系统管理软件

    1.管理物理服务器
    > Borg是一个分布式集群操作系统。与Apache Mesos类似，Borg负责在集群层面管理任务的编排工作
    2.存储：多层结构组成存储系统
    > 最底层由称为D的服务提供(D代表磁盘Disk，但是D可以同时使用磁盘和SSD)。D是一个文件服务器，几乎运行在整个集群的多有物理服务器上
    > D服务的上一层被称为Colossus,Colossus建立了一个覆盖整个集群的文件系统。Colossus文件系统提供传统文件系统的操作接口，同时还支持复制与加密功能。Colossus是GFS的改进版本
    > 构建于Colossus之上，有几个类似数据库的服务可供选择
        - Bigtable是一个NoSQL数据库。
        - Spanner是可以提供SQL接口以及满足一致性要求的全球数据库
    3.网络
        基于OpenFlow协议的软件定义网络(SDN)
        带宽控制器(Bandwidth Enforcer, BwF)负责管理所有可用带宽。优化带宽的使用的目的不仅仅是降低成本。利用中心化的路由计算，可以解决以前在分布式路由模式下难以解决的流量迁移问题
        为了降低分布式集群的服务延迟，我们希望能够将用户指派给距离最近的、有空余容量的数据中心处理
        我们的全球负载均衡系统(GSLB)在三个层面上负责负载均衡工作：
        - 利用地理位置信息进行负载均衡DNS请求
        - 在用户服务层面进行负载均衡
        - 在远程调用(RPC)层面进行负载均衡
    4.分布式锁服务
        Chubby集群锁服务提供一个与文件系统类似的API用来操作锁
        可以用来处理异地、跨机房级别的锁请求
        使用Paxos协议来提供分布式一致性
        Chubby是实现主实例选举(Master-Election)过程的关键组件
        适合存放那种对一致性要求非常高的数据
    5.监控与警报系统
        监控系统是服务运维中不可或缺的部分
        主要有几种方式使用监控系统:
        - 对真实问题进行报警
        - 对比服务更新前后的状态变化：新的版本是否让软件服务器运行得更快
        - 检查资源使用量随时间的变化情况，这个信息对合理制定资源计划很有用
    6.软件基础设施
        Google的底层软件基础设施的设计目标是最高效地使用Google的硬件基础设施
        通信协议gRPC，基于Protocol Buffer
    7.研发环境
