# 第一章 介绍
* 不能讲碰运气当成战略  -- SRE俗语

## 系统管理员模式
雇佣系统管理员（sysadmin）运维复杂的计算机系统，是行业内一直以来的普遍做法
传统研发团队和运维团队分歧的焦点主要在软件新版本、新配置的变更的发布速度上
研发部门关注的是如何能够更快速地构建和发布新功能，运维部门更关注的是如何能在他们值班期间避免发生故障

> Google解决之道：SRE
    SRE团队通过雇佣软件工程师，创造软件系统来维护系统运行以替代传统模型中的人工操作
    SRE起源：让软件工程师来设计一个新型运维团队的结果

    SRE方法论中的主要模块，就是SRE团队的构成。每个SRE团队里基本上有两类工程师
    - 第一类 团队中50%-60%是标准的软件工程师-能够正常通关Google软件工程师招聘流程的人
    - 第二类 其他40%-50%则是基本满足Google软件工程师标准（具备85%-99%所要求的技能），但是同时具有一定程度的其他技术能力的工程师
        - UNIX系统内部细节
        - 1～3层网络知识是Google最看重的两类额外的技术能力
        另外，所有的SRE团队成员都必须非常愿意、也非常相信用软件工程方法可以解决复杂的运维问题
    SRE团队的特点：1.对重复性、手工性的操作有天然的排斥感 2.有足够的技术能力快速开发出软件系统以替代手工操作
    SRE模型成功的关键在于对工程的关注

> DevOps && SRE
    - DevOps核心思想是尽早将IT相关技术与产品设计和开发过程结合起来，着重强调自动化而不是人工操作，以及利用软件工程手段执行运维任务。这些思想与SRE核心思想和实践经验相符合
        DevOps是SRE核心理念的普适版，可以用于更广范围内的组织结构、管理结构和人员安排
    - SRE是DevOps模型在Google的具体实践，带有一些特别的扩展

## SRE方法论
    虽然每个SRE团队都有自己的工作流程、优先级定义以及日常工作规范，但是所有的SRE团队都有一套共同的核心方法论。
    SRE团队要承担一下几类职责：
    - 可用性改进、延迟优化、性能优化、效率优化
    - 变更管理
    - 监控
    - 紧急事务处理以及容量规划与管理

    > 确保长期关注研发工作
    > 在保障服务SLO的前提下最大化迭代速度
        正面面对迭代创新的速度与产品稳定程度之间的矛盾，使用的工具是**错误预算**
        错误预算：任何产品都不是，也不应该做到100%可靠。
            人和软件系统都不应该一味追求100%可靠。对用户来说99.999%和100%的可用性是没有实质区别的
            如果100%不是一个正缺的可靠性目标，那么多少才是呢？这其实并不是一个技术问题，而是一个产品问题。
            - 基于用户的使用习惯，服务可靠性要达到什么程度用户才会满意？
            - 如果这项服务的可靠程度不够，用户是否有其他的替代选择？
            - 服务的可靠程度是否会影响用户对这项服务的使用模式？
        公司的商业部门或者产品部门必须建立起一个合理的可靠性目标，错误预算=1-可靠性目标
        错误预算可以用于什么范畴？
            研发团队需要用这个预算上线新功能，吸引新用户。理想情况下，我们应该使用错误预算来最大化新功能上线的速度，同时保障服务质量。这个基本模型建立起来之后，许多常见的战术策略，例如灰度发布、1%AB测试等就全说的通了。这些战术手段是为了更合理的使用整个服务的错误预算
    > 监控系统
        监控系统是SRE团队监控服务质量和可用性的一个主要手段。监控系统不应该依赖人来分析报警信息，而是应该有系统自动分析，仅当需要用户执行某种操作时，才需要通知用户

        监控系统应该只有三类输出：
        - 紧急警报(Alert)
            意味着收到警报的用户需要立即执行某种操作，目标是解决某种已经发生的问题，或者是避免即将发生的问题
        - 工单(Ticket)
            意味着接受工单的用户应该执行某种操作，但是并非立即执行。系统并不能自动解决目前的情况，但是如果一个用户在几天内执行这项操作，系统不会受到任何影响
        - 日志(Logging)
            平时没有人需要关注日志信息，但是日志信息依然被收集起来以备调试和事后分析时使用。正确的做法是平时没人会去主动阅读日志，除非有特殊需要
    > 应急事件处理
        可靠性是MTTF(平均失败时间)和MTTR(平均恢复时间)的函数。评价一个团队将系统恢复到正常情况的最有效指标就是MTTR
        运维手册(Playbook)
    > 变更管理
        SRE的经验告诉我们，大概70%的生产事故由某种部署的变更而触发
        变更管理的实践是使用自动化来完成一下几个项目：
        - 采用渐进式发布机制
        - 迅速而准确地检测到问题的发生
        - 当出现问题时，安全迅速地回退改动
    > 需求预测和容量规划
        保障一个业务有足够的容量和冗余度去服务预测中的未来需求
        容量规划几个步骤：
        - 必须有一个准确的自然增长需求预测模型，需求预测的时间应该超过资源获取的时间
        - 规划中必须有准确的非自然增长的需求来源的统计
        - 必须有周期性压力测试，以便准确地将系统原始资源信息与业务容量对应起来
        
        因为服务容量对可用性来说是极为重要的，很自然的，SRE应该主导容量规划的过程，SRE主导资源部署的过程
    > 资源部署
        资源的部署(provisinging)是变更管理与容量规划的结合物。在我们的经验里，资源的部署和配置必须能够非常迅速地完成，而且仅仅是在必要的时候才执行
    > 效率与性能
        高效地利用各种资源是任何赢利性服务都要关心的。因为SRE最终负责容量的部署和配置，因此SRE也必须承担起任何有关利用率的讨论及改进。
        因为一个服务的利用率指标通常依赖于这个服务的工作方式以及对容量的配置与部署上。密切关注服务的容量配置策略，进而改进资源利用率，可以有效地降低系统的总成本
        一个业务总体资源的使用情况是由一下几个因素驱动的：
        - 用户需求(流量)、
        - 可用容量
        - 软件的资源使用效率
        SRE可以通过模型预测用户需求，合理部署和配置可用容量，同时可以改软件以提升资源使用效率。

        SRE的目标是根据一个预设的延迟目标部署和维护足够的容量
        SRE和产品研发团队应该共同监控和优化整个系统的性能，这就相当于给服务增加容量和提升效率了


## 小结
        Google SRE代表了对行业现存管理大型复杂服务的最佳实践的一个重要突破。
