# 第六章 分布式系统的监控

> Google的SRE团队在构建监控系统和报警系统方面遵循一些核心思想和最佳实践

##术语定义
> 监控(monitoring)
    收集、处理、汇总，并且显示关于某个系统的实时量化数据
> 白盒监控(white-box monitoring)
    依靠系统内部暴露的一些性能指标进行监控。包括日志分析、Java虚拟机提供的监控接口，或者一个列出内部统计数据的HTTP接口进行监控
> 黑盒监控(black-box monitoring)
    通过测试某种外部用户可见的系统行为进行监控
> 监控台页面(dashboard)
    提供某个服务核心指标一览服务的应用程序
> 警报(Alert)
    目标对象是某个人发向某个系统地址的一个通知。目的地可以包括工单系统、E-mail地址，或者某个传呼机
> 根源问题(root cause)
    指系统(软件或流程)中的某种缺陷。这个缺陷如果被修复，就可以保证这种问题不会再以同样的方式发生
> 节点活着机器(node/machine)
    物理机、虚拟机，或者容器内运行的某个实例
    某个单独的物理机器上可能有多个服务需要监控，这些服务可能具有如下特点:
    - 相互关联的服务:例如Web服务器与对应的缓存服务器
    - 不相关的服务，它们仅仅共享硬件:例如代码仓库和把文件存放在代码仓库中的配置管理系统的主进程
> 推送(push)
    关于某个服务正在运行的软件或者配置文件的任何改动

## 为什么要监控
    - 分析长期趋势
        数据库目前的数据量，以及增长速度
    - 跨时间范围的比较，或者是观察实验组与控制组之间的区别
    - 报警
        某项东西出现故障了，需要有人立刻修复！或者某项东西可能很快会出现故障，需要有人尽快查看
    - 构建监控台页面
        监控台页面应该可以回答有关服务的一些基本问题，通常会包括常见的4个"黄金指标"
    - 临时性的回朔分析(也就是在线调试)

## 对监控系统设置合理预期

## 现象与原因
    监控系统应该解决两个问题:什么东西出故障了，以及为什么出故障
    现象和原因的区分是候检信噪比高的监控系统时最重要的概念

## 黑盒监控与白盒监控
    Google大量依赖白盒监控，黑盒监控用得虽然不多，但都是在关键地方使用。
    黑盒监控面向现象，代表了目前正在发生的--而非预期会发生的--问题，即系统现在有故障
    白盒监控则大量依赖对系统内部信息的检测，如系统日志、抓取提供指标信息的HTTP节点等

## 4个黄金指标
    监控系统的四个黄金指标分别是延迟、流量、错误和饱和度(saturation)
    - 延迟
        服务处理某个请求所需要的时间。这里区分成功请求和失败请求很重要
    - 流量
        使用系统中的某个高层次的指标针对系统负载需求进行的度量。
    - 错误
    - 饱和度

## 关于长尾问题
    构建监控系统时，很多人都倾向于采用某种量化指标的平均值:延迟平均值，节点的平均使用率，数据库容量的平均值
## 度量指标时采用合适的精度
    系统的不同部分应该以不同的精度进行度量
    应仔细设计度量指标的精确度
    设计监控系统时一定要追求简化:
    - 
